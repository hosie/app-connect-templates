$integration: 'http://ibm.com/appconnect/integration/v2/integrationFile'
integration:
  type: trigger-action
  trigger-interfaces:
    trigger-interface-1:
      type: event-trigger
      triggers:
        CREATED:
          input-context:
            data: incident
          assembly:
            $ref: '#/integration/assemblies/assembly-1'
          options: {}
      connector-type: servicenow
  action-interfaces:
    action-interface-1:
      type: api-action
      business-object: Identify
      connector-type: watsonlt
      actions:
        IDENTIFY: {}
    action-interface-2:
      type: api-action
      business-object: message
      connector-type: slack
      actions:
        CREATE: {}
    action-interface-3:
      type: api-action
      business-object: message
      connector-type: slack
      actions:
        CREATE: {}
    action-interface-4:
      type: api-action
      business-object: message
      connector-type: slack
      actions:
        CREATE: {}
  assemblies:
    assembly-1:
      assembly:
        execute:
          - custom-action:
              name: Watson Language Translator Identify
              target:
                $ref: '#/integration/action-interfaces/action-interface-1'
              action: IDENTIFY
              map:
                mappings:
                  - text:
                      template: '{{$Trigger.short_description}}'
                $map: 'http://ibm.com/appconnect/map/v1'
                input:
                  - variable: Trigger
                    $ref: '#/trigger/payload'
          - if:
              name: If
              input:
                - variable: Trigger
                  $ref: '#/trigger/payload'
                - variable: WatsonLanguageTranslatorIdentify
                  $ref: >-
                    #/node-output/Watson Language Translator
                    Identify/response/payload
              branch:
                - condition:
                    '{{$WatsonLanguageTranslatorIdentify.languages[0].language}}':
                      '=': en
                  execute:
                    - create-action:
                        name: Slack Create message
                        target:
                          $ref: '#/integration/action-interfaces/action-interface-2'
                        map:
                          mappings:
                            - channel:
                                template: C7V8QT9QE
                            - text:
                                template: >-
                                  New incident: {{$Trigger.sys_id}}
                                  {{$Trigger.short_description}}
                          $map: 'http://ibm.com/appconnect/map/v1'
                          input:
                            - variable: Trigger
                              $ref: '#/trigger/payload'
                            - variable: WatsonLanguageTranslatorIdentify
                              $ref: >-
                                #/node-output/Watson Language Translator
                                Identify/response/payload
                  map:
                    $map: 'http://ibm.com/appconnect/map/v1'
                    input:
                      - variable: Trigger
                        $ref: '#/trigger/payload'
                      - variable: SlackCreatemessage
                        $ref: >-
                          #/block/If/node-output/Slack Create
                          message/response/payload
                      - variable: WatsonLanguageTranslatorIdentify
                        $ref: >-
                          #/node-output/Watson Language Translator
                          Identify/response/payload
                    mappings:
                      - team:
                          template: English team
                - condition:
                    '{{$WatsonLanguageTranslatorIdentify.languages[0].language}}':
                      '=': fr
                  execute:
                    - create-action:
                        name: Slack Create message 2
                        target:
                          $ref: '#/integration/action-interfaces/action-interface-3'
                        map:
                          mappings:
                            - channel:
                                template: C7UC6VD1Q
                            - text:
                                template: >-
                                  Nouvel incident: {{$Trigger.sys_id}}
                                  {{$Trigger.short_description}}
                          $map: 'http://ibm.com/appconnect/map/v1'
                          input:
                            - variable: Trigger
                              $ref: '#/trigger/payload'
                            - variable: WatsonLanguageTranslatorIdentify
                              $ref: >-
                                #/node-output/Watson Language Translator
                                Identify/response/payload
                  map:
                    $map: 'http://ibm.com/appconnect/map/v1'
                    input:
                      - variable: Trigger
                        $ref: '#/trigger/payload'
                      - variable: SlackCreatemessage2
                        $ref: >-
                          #/block/If/node-output/Slack Create message
                          2/response/payload
                      - variable: WatsonLanguageTranslatorIdentify
                        $ref: >-
                          #/node-output/Watson Language Translator
                          Identify/response/payload
                    mappings:
                      - team:
                          template: French team
              else:
                execute: []
                map:
                  $map: 'http://ibm.com/appconnect/map/v1'
                  input:
                    - variable: Trigger
                      $ref: '#/trigger/payload'
                    - variable: WatsonLanguageTranslatorIdentify
                      $ref: >-
                        #/node-output/Watson Language Translator
                        Identify/response/payload
                  mappings:
                    - team:
                        template: General
              output-schema:
                required:
                  - team
                properties:
                  team:
                    type: string
                    title: team
                type: object
          - if:
              name: If 2
              input:
                - variable: Trigger
                  $ref: '#/trigger/payload'
                - variable: WatsonLanguageTranslatorIdentify
                  $ref: >-
                    #/node-output/Watson Language Translator
                    Identify/response/payload
                - variable: If
                  $ref: '#/node-output/If/response/payload'
              branch:
                - condition:
                    '{{$Trigger.urgency}}':
                      '=': '1'
                  execute:
                    - create-action:
                        name: Slack Create message 3
                        target:
                          $ref: '#/integration/action-interfaces/action-interface-4'
                        map:
                          mappings:
                            - channel:
                                template: C7UDQ9KSQ
                            - text:
                                template: >-
                                  New urgent incident raised against
                                  {{$If.team}}: {{$Trigger.sys_id}}
                                  {{$Trigger.short_description}}
                          $map: 'http://ibm.com/appconnect/map/v1'
                          input:
                            - variable: Trigger
                              $ref: '#/trigger/payload'
                            - variable: WatsonLanguageTranslatorIdentify
                              $ref: >-
                                #/node-output/Watson Language Translator
                                Identify/response/payload
                            - variable: If
                              $ref: '#/node-output/If/response/payload'
                  map:
                    $map: 'http://ibm.com/appconnect/map/v1'
                    input:
                      - variable: Trigger
                        $ref: '#/trigger/payload'
                      - variable: SlackCreatemessage3
                        $ref: >-
                          #/block/If 2/node-output/Slack Create message
                          3/response/payload
                      - variable: WatsonLanguageTranslatorIdentify
                        $ref: >-
                          #/node-output/Watson Language Translator
                          Identify/response/payload
                      - variable: If
                        $ref: '#/node-output/If/response/payload'
                    mappings: []
              else:
                execute: []
                completion-action:
                  terminate:
                    info:
                      input:
                        - variable: Trigger
                          $ref: '#/trigger/payload'
                        - variable: WatsonLanguageTranslatorIdentify
                          $ref: >-
                            #/node-output/Watson Language Translator
                            Identify/response/payload
                        - variable: If
                          $ref: '#/node-output/If/response/payload'
                      message: OK
                      status-code: 200
              output-schema: {}
  name: Assign ServiceNow incidents on Slack based on the language
  description: >-
    This template uses Watson Language Translator to detect the language of new
    ServiceNow incidents, then send messages to the appropriate Slack channels
    based on the language.  It also sends a message to a separate Slack channel
    for the most urgent incidents.
  todo: >
    To refer to these instructions while editing the flow, open [the github
    page](https://github.com/ot4i/app-connect-templates/blob/master/resources/markdown/Assign%20ServiceNow%20incidents%20on%20Slack%20based%20on%20the%20language_instructions.md)
    (opens in a new window).


    1. Click **Create flow** to start using the template.

    1. Connect to your [ServiceNow
    account](https://developer.ibm.com/integration/docs/app-connect/how-to-guides-for-apps/use-ibm-app-connect-servicenow/).

    1. Connect to your [Watson Language Translator
    account](https://developer.ibm.com/integration/docs/app-connect/how-to-guides-for-apps/use-ibm-app-connect-watson-language-translator/).

    1. Click the first **If** node and, if necessary, change the two-character
    language codes according to your business needs. If you change the language,
    you'll also need to expand **Output data** for each branch of the **If**
    node to change the name of the team who'll deal with the incident.

    1. Connect to your [Slack
    account](https://developer.ibm.com/integration/docs/app-connect/how-to-guides-for-apps/use-ibm-app-connect-slack/).

    1. For each Slack "Create message" action in the If node, select the channel
    that you want to post your message to for the language that's specified for
    that branch of the If node. If you've changed the language, you might also
    want to update the **Text** field.

    1. For the Slack "Create message" action in the **If 2** node, select the
    channel that you want to post your message to for urgent incidents.   

    1. To start the flow, in the banner open the options menu [&#8942;] then
    click **Start flow**.
models: {}
